<div *ngIf="!isLoading && currentPhrase && currentStep" class="space-y-6">
  
  <div class="flex items-center justify-between">
    <div>
      <a routerLink="/dashboard" class="inline-flex items-center text-blue-600 hover:text-blue-700 mb-2">
        <i-feather name="chevron-left" class="h-4 w-4 mr-1"></i-feather>
        Back to Dashboard
      </a>
      <h1 class="text-2xl font-bold text-gray-900">{{ currentPhrase.title }}</h1>
    </div>
    <div class="flex items-center space-x-4">
      <div class="flex items-center text-gray-500">
        <i-feather name="clock" class="h-4 w-4 mr-1"></i-feather>
        <span class="text-sm">{{ currentPhrase.duration }} min</span>
      </div>
      <div class="flex items-center text-gray-500">
        <i-feather name="bar-chart" class="h-4 w-4 mr-1"></i-feather>
        <span class="text-sm">{{ currentPhrase.points }} XP</span>
      </div>
      <app-badge [variant]="currentPhrase.difficulty === 'beginner' ? 'success' : currentPhrase.difficulty === 'intermediate' ? 'warning' : 'danger'">
        {{ currentPhrase.difficulty.charAt(0).toUpperCase() + currentPhrase.difficulty.slice(1) }}
      </app-badge>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
    <div class="flex justify-between items-center mb-2">
      <span class="text-sm font-medium text-gray-700">Step {{ currentStepIndex + 1 }} of {{ currentPhrase.steps.length }}</span>
      <span class="text-sm text-gray-500">{{ progressPercentage | number:'1.0-0' }}% Complete</span>
    </div>
    <app-progress-bar [value]="progressPercentage" [showValue]="false" color="blue"></app-progress-bar>
  </div>

  <app-card>
    <app-card-content class="p-6">
      <ng-container [ngSwitch]="currentStep.type">
        
        <ng-container *ngSwitchCase="'introduction'">
          <div class="space-y-4">
            <h3 class="text-xl font-semibold text-gray-900">{{ currentStep.title }}</h3>
            <p class="text-gray-700 leading-relaxed">{{ currentStep.content }}</p>
            <div *ngIf="currentStep.media" class="mt-6">
              <img *ngIf="currentStep.media.type === 'image'" [src]="currentStep.media.url" [alt]="currentStep.title" class="rounded-lg w-full max-w-2xl mx-auto" />
              <div *ngIf="currentStep.media.type === 'video' && (currentStepVideo$ | async) as video" class="aspect-video w-full max-w-3xl mx-auto rounded-lg overflow-hidden shadow-lg">
                <video [src]="video.url" controls class="w-full h-full bg-black"></video>
              </div>
            </div>
            <div class="pt-4">
              <app-button variant="primary" (click)="goToNextStep()">
                <i-feather name="chevron-right" class="h-4 w-4 mr-2"></i-feather>
                Continue
              </app-button>
            </div>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'content'">
          <div class="space-y-4">
            <h3 class="text-xl font-semibold text-gray-900">{{ currentStep.title }}</h3>
            <p class="text-gray-700 leading-relaxed">{{ currentStep.content }}</p>
            <div *ngIf="currentStep.media" class="mt-6">
              <img *ngIf="currentStep.media.type === 'image'" [src]="currentStep.media.url" [alt]="currentStep.title" class="rounded-lg w-full max-w-2xl mx-auto" />
              <div *ngIf="currentStep.media.type === 'video' && (currentStepVideo$ | async) as video" class="aspect-video w-full max-w-3xl mx-auto rounded-lg overflow-hidden shadow-lg">
                <video [src]="video.url" controls class="w-full h-full bg-black"></video>
              </div>
            </div>
            <div class="pt-4">
              <app-button variant="primary" (click)="goToNextStep()">
                <i-feather name="chevron-right" class="h-4 w-4 mr-2"></i-feather>
                Continue
              </app-button>
            </div>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'summary'">
          <div class="space-y-4">
            <h3 class="text-xl font-semibold text-gray-900">{{ currentStep.title }}</h3>
            <p class="text-gray-700 leading-relaxed">{{ currentStep.content }}</p>
            <div *ngIf="currentStep.media" class="mt-6">
              <img *ngIf="currentStep.media.type === 'image'" [src]="currentStep.media.url" [alt]="currentStep.title" class="rounded-lg w-full max-w-2xl mx-auto" />
              <div *ngIf="currentStep.media.type === 'video' && (currentStepVideo$ | async) as video" class="aspect-video w-full max-w-3xl mx-auto rounded-lg overflow-hidden shadow-lg">
                <video [src]="video.url" controls class="w-full h-full bg-black"></video>
              </div>
            </div>
            <div class="pt-4">
              <app-button variant="primary" (click)="goToNextStep()">
                <i-feather name="chevron-right" class="h-4 w-4 mr-2"></i-feather>
                Finish Phrase
              </app-button>
            </div>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'quiz'">
          <div class="space-y-4">
            <h3 class="text-xl font-semibold text-gray-900">{{ currentStep.title }}</h3>
            <p class="text-gray-700 mb-6">{{ currentStep.content }}</p>
            <div *ngIf="currentStep.options" class="space-y-3 mt-4">
              <div *ngFor="let option of currentStep.options" class="relative">
                <button
                  (click)="handleQuizAnswer(option)"
                  [disabled]="quizSubmitted"
                  class="w-full p-3 text-left border rounded-lg transition-colors"
                  [ngClass]="{
                    'bg-blue-50 border-blue-500 text-blue-700': userAnswers[currentStep.id] === option,
                    'border-gray-300 hover:bg-gray-50': userAnswers[currentStep.id] !== option,
                    'bg-green-50 border-green-500': quizSubmitted && currentStep.correctAnswer === option,
                    'bg-red-50 border-red-500': quizSubmitted && userAnswers[currentStep.id] === option && userAnswers[currentStep.id] !== currentStep.correctAnswer
                  }"
                >
                  {{ option }}
                  <i-feather *ngIf="quizSubmitted && currentStep.correctAnswer === option" name="check-circle" class="absolute right-3 top-3 h-5 w-5 text-green-500"></i-feather>
                  <i-feather *ngIf="quizSubmitted && userAnswers[currentStep.id] === option && userAnswers[currentStep.id] !== currentStep.correctAnswer" name="x-circle" class="absolute right-3 top-3 h-5 w-5 text-red-500"></i-feather>
                </button>
              </div>
            </div>
            <div *ngIf="quizSubmitted" class="p-4 rounded-lg" [ngClass]="quizResult === 'correct' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'">
              <p class="font-medium">
                {{ quizResult === 'correct' ? 'Correct! Well done.' : 'Incorrect. The correct answer is highlighted above.' }}
              </p>
            </div>
            <div class="pt-4 flex justify-between">
              <app-button variant="outline" (click)="goToPreviousStep()" [disabled]="currentStepIndex === 0">
                <i-feather name="chevron-left" class="h-4 w-4 mr-2"></i-feather>
                Back
              </app-button>
              <app-button *ngIf="!quizSubmitted" variant="primary" (click)="submitQuiz()" [disabled]="!userAnswers[currentStep.id]">Submit Answer</app-button>
              <app-button *ngIf="quizSubmitted" variant="primary" (click)="goToNextStep()">
                <i-feather name="chevron-right" class="h-4 w-4 mr-2"></i-feather>
                Continue
              </app-button>
            </div>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'exercise'">
          </ng-container>
        <ng-container *ngSwitchCase="'practice'">
          </ng-container>

      </ng-container>
    </app-card-content>
  </app-card>



<div *ngIf="isLoading">
  <div class="flex items-center justify-center h-[500px]">
    <div class="text-center">
      <i-feather name="book-open" class="h-12 w-12 text-blue-500 mx-auto mb-4 animate-pulse"></i-feather>
      <h2 class="text-xl font-semibold text-gray-900">Loading Practice Phrase...</h2>
    </div>
  </div>
</div>